template(name='tickets')
    table.table
        each tickets
            tr
                td #{employee.name}
                td #{employee.client.name}
                td
                    +linkTo(route='ticket.show' data=getData)
                        span #{description}
                td(class=type) #{type_locale}
                td(class=status_class) #{status_locale}
                td
                    //span(livestamp(createdAt))
                    span(data-livestamp=createdAt)

    +contentFor('navbar')
        li
            a(href='/tickets/new')
                i.icon-file
                | Создать

    +contentFor('breadcrumbs')
        li
            a(href='/tickets') Обращения

template(name='newTicket')
    .span6
        form
            label Сотрудник
            .input-control
                select(name='employee_id')
                    each employees
                        option(value=_id) #{name} #{position} из #{client.name}
            label Описание
            .input-control.textarea
                textarea(name='description')
            .input-control
                input(type='submit', value='Сохранить обращение')
    .span6
        if employee
            .panel
                .panel-header
                    | #{employee.name}
                .panel-content
                    span должность #{employee.position}
                    address email #{employee.email}
                    phone #{employee.phone}
        each tickets
            span #{description}
            span #{createdAt}
            hr
    
    +contentFor('breadcrumbs')
        li
            a(href='/tickets') Обращения
        li
            a(href='/tickets/new') Новое

template(name='showTicket')
    h1 Тикет #{doc_id} от #{employee.name}
    .row
        .span6
            .panel
                .panel-content
                    p #{description}
            unless type
                +classifyTicket
            if isClassified
                +assignTicket
            if isAssigned
                +processTicket
            if isInProgress
                +finishTicket
        .span6
            .tab-control(data-role='tab-control')
                ul.tabs
                    li.active
                        a(href='#page1') Инфо
                    li
                        a(href='#page2')
                            i.icon-user
                            | Инициатор
                    li
                        a(href='#page3')
                            | Знания
                    li
                        a(href='#page4')
                            | Проблемы
                .frames
                    .frame#page1.active
                        h2 ID #{doc_id}
                        if sla
                            h2 #{sla.name} реакция: {{to_duration response_duration_left}} из {{to_duration sla.response}} решение {{to_duration resolve_duration_left}} из {{to_duration sla.resolve}}
                        if response_percent
                            | осталось реакции #{response_percent}%
                            .progress-bar.small(data-role="progress-bar" data-value=response_percent data-color=response_class)
                        if resolve_percent
                            | осталось решения #{resolve_percent}%
                            .progress-bar.small(data-role="progress-bar" data-value=resolve_percent data-color=resolve_class)
                        h4 
                            | Создан
                            span(data-livestamp=createdAt) #{createdAt}
                        if classifiedAt
                            h4
                                | Классифицирован
                                span(data-livestamp=classifiedAt)  #{classifiedAt}
                        if assignedAt
                            h4
                                | Назначен 
                                span(data-livestamp=assignedAt) #{assignedAt}
                        if respondedAt
                            h4
                                | В работе
                                span(data-livestamp=assignedAt) #{respondedAt}
                        
                        h3 Тип тикета #{type_locale}
                        
                        h4 
                            | Статус
                            span(class=status_class) #{status_locale}
                        if assigned_to
                            h3 Ответственный #{assigned_to.name}

                    .frame#page2
                        h3 Инициатор
                        span #{employee.name} #{employee.position}
                    .frame#page3
                    .frame#page4
    .row
        a.remove.button.danger Удалить
    
    +contentFor('navbar')
        span.element
            a(href='/tickets/new')
                i.icon-file
                | Создать
                
    +contentFor('breadcrumbs')
        li
            a(href='/tickets') Обращения
        li
            a(href="/tickets/#{_id}") Обращение #{doc_id}

template(name='assignTicket')
    form
        .input-control.select
            label Ответственный
                select(name='agent_id')
                    each agents
                        option(value=_id) #{name}
        .input-control
            input.default(type='submit' value='Назначить')
            button.reclassify Реклассифицировать
template(name='finishTicket')
    form
        .input-control
            button.finish Завершить работы

template(name='processTicket')
    button.default.process В работу

template(name='classifyTicket')
    form
        .input-control.select
            label
                | SLA
                select(name='sla_id')
                    each slas
                        option(value=_id) #{name}
        .input-control.radio
            label
                input(type='radio', value='Incident', name='ticketType') 
                span.check
                | Инцидент
        .input-control.radio
            label
                input(type='radio', value='ServiceRequest', name='ticketType') 
                span.check
                | Запрос на обслуживание
        .input-control.radio                
            label
                input(type='radio', value='Rfc', name='ticketType') 
                span.check
                | Rfc
        .input-control.radio                
            label
                input(type='radio', value='Feedback', name='ticketType') 
                span.check
                | Feedback
        .input-control
            input(type='submit', value='Классифицировать')